<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Маршрут самолёта</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<style>
  body {
    margin:0;
    font-family:Arial, sans-serif;
    background:#f9fcff;
    overflow-x:hidden;
  }

  .back-btn {
    display:inline-block;
    margin:15px;
    padding:10px 16px;
    background:#0073e6;
    color:#fff;
    text-decoration:none;
    border-radius:6px;
    font-size:14px;
    font-weight:bold;
    transition:background 0.3s ease;
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
  }
  .back-btn:hover { background:#005bb5; }

  .map-wrap {
    position:relative;
    width:95%;
    max-width:1400px;
    margin:20px auto;
    aspect-ratio:2/1;
    overflow:hidden;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.25);
    touch-action:none;
  }

  .map-inner {
    width:100%;
    height:100%;
    background-image:url('images/world-map.png'); 
    background-size:contain;
    background-repeat:no-repeat;
    background-position:center;
    transform-origin:center center;
    position:relative;
  }

  .dot {
    position:absolute;
    transform:translate(-50%,-50%);
    z-index:5;
    cursor:pointer;
    text-align:center;
  }
  .dot::before {
    content:"";
    position:absolute;
    width:14px; height:14px;
    border-radius:50%;
    background:#e60000;
    box-shadow:0 0 20px 12px rgba(230,0,0,0.25);
    transform:translate(-50%,-50%);
    left:50%; top:50%;
  }

  .label {
    position:absolute;
    top:-24px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(255,255,255,0.95);
    padding:3px 8px;
    border-radius:6px;
    font-size:13px;
    font-weight:bold;
    white-space:nowrap;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
  }

  .tooltip {
    position:absolute;
    bottom:120%;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.8);
    color:#fff;
    padding:6px 10px;
    border-radius:6px;
    font-size:12px;
    white-space:nowrap;
    opacity:0;
    pointer-events:none;
    transition:opacity 0.3s ease, transform 0.3s ease;
  }
  .dot:hover .tooltip { opacity:1; transform:translateX(-50%) translateY(-5px); }

  .plane {
    position:absolute;
    width:36px;
    height:36px;
    background:url("images/airplaneee.png") no-repeat center/contain;
    transform:translate(-50%,-50%) rotate(0deg);
    z-index:10;
    transition: left 3s ease-in-out, top 3s ease-in-out, transform 1.2s ease-in-out;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
  }

  svg.route-line {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    overflow:visible;
    z-index:3;
  }
  .route-path {
    fill:none;
    stroke:red;
    stroke-width:2;
    stroke-dasharray:1000;
    stroke-dashoffset:1000;
    animation: drawPath 14s linear forwards;
  }
  @keyframes drawPath { to { stroke-dashoffset: 0; } }

  /* Mobile tweaks */
  @media (max-width: 768px) {
    .map-wrap { width:100%; aspect-ratio: 1.5/1; }
    .label { font-size:11px; padding:2px 6px; }
    .tooltip { display:none; }
    .plane { width:26px; height:26px; }
    .back-btn { font-size:13px; padding:8px 14px; }

    .dot::before { width:10px; height:10px; } /* smaller dots */
  }
  @media (max-width: 480px) {
    .map-wrap { aspect-ratio: 1.1/1; }
    .label { font-size:10px; }
    .plane { width:20px; height:20px; }
    .back-btn { font-size:12px; padding:7px 12px; margin:10px; }
    .dot::before { width:8px; height:8px; } /* even smaller dots */
  }
</style>
</head>
<body>

<a href="index.html" class="back-btn">← Назад</a>

<div class="map-wrap" id="map">
  <div class="map-inner" id="mapInner">
    <svg class="route-line">
      <path id="routePath" class="route-path" d=""/>
    </svg>

    <!-- <div class="dot" style="left:34%; top:28%;"><div class="label">London</div><div class="tooltip">🇬🇧 Heathrow</div></div> -->
     <div class="dot" style="left:44.7%; top:26.5%;"><div class="label">London</div><div class="tooltip">🇬🇧 Heathrow</div></div>
    <!-- <div class="dot" style="left:36.5%; top:31%;"><div class="label">Belgium</div><div class="tooltip">🇧🇪 Brussels</div></div> -->
     <div class="dot" style="left:49.5%; top:35%;"><div class="label">Belgium</div><div class="tooltip">🇧🇪 Brussels</div></div>
    <div class="dot" style="left:45.5%; top:39%;"><div class="label">Istanbul</div><div class="tooltip">🇹🇷 Airport</div></div>
    <!-- <div class="dot" style="left:52%; top:39%;"><div class="label">Tbilisi</div><div class="tooltip">🇬🇪 Intl</div></div> -->
     <div class="dot" style="left:53.4%; top:37.3%;"><div class="label">Tbilisi</div><div class="tooltip">🇬🇪 Intl</div></div>
    <div class="dot" style="left:52%; top:42%;"><div class="label">Batumi</div><div class="tooltip">🇬🇪 Intl</div></div>
    <div class="dot" style="left:63%; top:37%;"><div class="label">Issyk-Kul</div><div class="tooltip">🇰🇬 Tamchy</div></div>
    <div class="dot" style="left:48%; top:54%;"><div class="label">Sharm</div><div class="tooltip">🇪🇬 Airport</div></div>
    <!-- <div class="dot" style="left:55%; top:56%;"><div class="label">Madina</div><div class="tooltip">🇸🇦 Intl</div></div> -->
     <div class="dot" style="left:57.8%; top:50.6%;"><div class="label">Madina</div><div class="tooltip">🇸🇦 Intl</div></div>

    <div class="plane" id="plane"></div>
  </div>
</div>

<script>
const route = [
  // {x:"34%", y:"28%"},
  {x:"44.7%", y:"26.5%"},
  // {x:"36.5%", y:"31%"},
  {x:"49.5%", y:"35%"},
  {x:"45.5%", y:"39%"},
  {x:"53.4%", y:"37.3%"},
  {x:"52%", y:"42%"},
  {x:"63%", y:"37%"},
  {x:"48%", y:"54%"},
  {x:"57.8%", y:"50.6%"}
  // {x:"55%", y:"56%"}
];

const plane = document.getElementById("plane");
const routePath = document.getElementById("routePath");

function buildPath(points) {
  let d = `M ${points[0].x} ${points[0].y}`;
  for (let j=1; j<points.length; j++) {
    d += ` L ${points[j].x} ${points[j].y}`;
  }
  return d;
}
routePath.setAttribute("d", buildPath(route));

let i = 0;
function movePlane() {
  const point = route[i];
  const next = route[(i+1)%route.length];
  plane.style.left = point.x;
  plane.style.top = point.y;

  const px = parseFloat(point.x), py = parseFloat(point.y);
  const nx = parseFloat(next.x), ny = parseFloat(next.y);
  const angle = Math.atan2(ny - py, nx - px) * (180/Math.PI);

  setTimeout(()=>{
    plane.style.transform = `translate(-50%,-50%) rotate(${angle}deg)`;
    plane.style.left = next.x;
    plane.style.top = next.y;
    i = (i+1)%route.length;
    setTimeout(movePlane, 3200);
  },300);
}
movePlane();

/* Zoom & Pan + Double Tap */
const mapInner = document.getElementById("mapInner");
let scale = 1, startDist = 0, lastX = 0, lastY = 0, posX=0, posY=0;
let lastTap = 0, tapCount = 0;

function updateTransform() {
  mapInner.style.transform = `translate(${posX}px,${posY}px) scale(${scale})`;
}

document.getElementById("map").addEventListener("touchstart", e=>{
  if(e.touches.length===2){
    startDist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
  } else if(e.touches.length===1){
    lastX = e.touches[0].clientX - posX;
    lastY = e.touches[0].clientY - posY;

    const now = new Date().getTime();
    if(now - lastTap < 300){
      tapCount++;
      if(tapCount === 1){ // one-finger double tap
        scale = scale > 1 ? 1 : scale*2;
      } else if(tapCount === 2){ // two-finger double tap
        scale = Math.max(1, scale/2);
      }
      posX = 0; posY = 0;
      updateTransform();
      tapCount = 0;
    } else {
      tapCount = 0;
    }
    lastTap = now;
  }
});

document.getElementById("map").addEventListener("touchmove", e=>{
  if(e.touches.length===2){
    let newDist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    scale *= newDist / startDist;
    scale = Math.max(1, Math.min(scale, 4));
    startDist = newDist;
  } else if(e.touches.length===1){
    posX = e.touches[0].clientX - lastX;
    posY = e.touches[0].clientY - lastY;
  }
  updateTransform();
});
</script>
</body>
</html>
